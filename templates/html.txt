<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if page %}{{ page|capitalize }} - {% endif %}E-Waste Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="bg-green-50 text-gray-900 min-h-screen flex flex-col">
    <nav class="sticky top-0 z-50 bg-white shadow-lg border-b-4 border-green-500">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="{{ url_for('home') }}" class="flex items-center space-x-2">
                    <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <span class="text-2xl font-bold text-green-700">E‚ÄëWaste Assistant</span>
                </a>
                <div class="flex items-center space-x-8">
                    <a href="{{ url_for('home') }}" class="text-gray-700 hover:text-green-600 transition-colors font-medium">Home</a>
                    <a href="{{ url_for('about') }}" class="text-gray-700 hover:text-green-600 transition-colors font-medium">About</a>
                    <a href="{{ url_for('contact') }}" class="text-gray-700 hover:text-green-600 transition-colors font-medium">Contact</a>
                    <a href="{{ url_for('help') }}" class="text-gray-700 hover:text-green-600 transition-colors font-medium">Help</a>
                    {% if not session.get('logged_in') %}
                        <a href="{{ url_for('signin') }}" class="text-gray-700 hover:text-green-600 transition-colors font-medium">Sign In</a>
                        <a href="{{ url_for('signup') }}" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium shadow-md">Sign Up</a>
                    {% else %}
                        <a href="{{ url_for('dashboard') }}" class="text-gray-700 hover:text-green-600 transition-colors font-medium">Dashboard</a>
                        <a href="{{ url_for('map_view') }}" class="text-gray-700 hover:text-green-600 transition-colors font-medium">Map</a>
                        <a href="{{ url_for('chatbot_page') }}" class="text-gray-700 hover:text-green-600 transition-colors font-medium">üí¨ Chat Assistant</a>
                        <a href="{{ url_for('upload') }}" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium shadow-md">Upload Device</a>
                        {% if session.get('email') == 'admin@ewasteassistant.com' %}
                            <a href="{{ url_for('admin_panel') }}" class="text-gray-700 hover:text-red-600 transition-colors font-medium">Admin</a>
                        {% endif %}
                        <a href="{{ url_for('signout') }}" class="text-gray-700 hover:text-green-600 transition-colors font-medium">Sign Out</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-1">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="fixed top-20 right-4 z-50 space-y-2">
                    {% for category, message in messages %}
                        <div class="bg-white border-l-4 {% if category == 'error' %}border-red-500{% elif category == 'success' %}border-green-500{% else %}border-blue-500{% endif %} p-4 rounded-lg shadow-lg max-w-sm">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    {% if category == 'error' %}
                                        <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                        </svg>
                                    {% elif category == 'success' %}
                                        <svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                        </svg>
                                    {% else %}
                                        <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                        </svg>
                                    {% endif %}
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm font-medium {% if category == 'error' %}text-red-800{% elif category == 'success' %}text-green-800{% else %}text-blue-800{% endif %}">
                                        {{ message }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        {% if page == 'home' %}
        <!-- Hero Carousel Section -->
        <section class="relative min-h-screen overflow-hidden">
            <!-- Carousel Container -->
            <div class="relative h-screen">
                <!-- Slide 1: E-Waste Awareness -->
                <div class="absolute inset-0 bg-gradient-to-br from-green-600 via-green-700 to-green-800 transition-opacity duration-1000 ease-in-out opacity-100" id="slide1">
                    <div class="absolute inset-0 bg-black opacity-20"></div>
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-5"></div>
                    <!-- Floating Elements -->
                    <div class="absolute top-20 left-10 w-20 h-20 bg-white bg-opacity-10 rounded-full animate-pulse"></div>
                    <div class="absolute top-40 right-20 w-16 h-16 bg-green-300 bg-opacity-20 rounded-full animate-bounce"></div>
                    <div class="absolute bottom-40 left-20 w-12 h-12 bg-white bg-opacity-15 rounded-full animate-ping"></div>
                    <div class="absolute bottom-20 right-10 w-24 h-24 bg-green-200 bg-opacity-10 rounded-full animate-pulse"></div>
                    
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-full flex items-center relative z-10">
                        <div class="text-center w-full">
                            <div class="flex justify-center mb-12 animate-fade-in-up">
                                <div class="w-32 h-32 bg-white bg-opacity-20 rounded-full flex items-center justify-center backdrop-blur-sm border border-white border-opacity-30 shadow-2xl animate-spin-slow">
                                    <svg class="w-16 h-16 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                            <h1 class="text-5xl md:text-6xl lg:text-7xl font-bold text-white mb-8 leading-tight animate-fade-in-up animation-delay-200">
                                <span class="block bg-gradient-to-r from-white to-green-100 bg-clip-text text-transparent">E-Waste</span>
                                <span class="block text-4xl md:text-5xl lg:text-6xl mt-2">Assistant</span>
                            </h1>
                            <p class="text-lg md:text-xl lg:text-2xl text-green-100 mb-12 max-w-4xl mx-auto leading-relaxed font-light animate-fade-in-up animation-delay-400">
                                üå± Transform Your E-Waste into Environmental Solutions with 
                                <span class="font-semibold text-white">AI-Powered Recycling</span>
                            </p>
                            <div class="flex flex-col sm:flex-row gap-6 justify-center items-center max-w-2xl mx-auto animate-fade-in-up animation-delay-600">
                                {% if session.get('logged_in') %}
                                    <a href="{{ url_for('upload') }}" class="group w-full sm:w-auto inline-flex items-center justify-center px-8 py-4 bg-white text-green-600 font-semibold rounded-xl hover:bg-green-50 transition-all duration-300 shadow-xl hover:shadow-2xl transform hover:-translate-y-1">
                                        <svg class="w-5 h-5 mr-3 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                        </svg>
                                        Upload Your Device
                                    </a>
                                {% else %}
                                    <a href="{{ url_for('signin') }}" class="group w-full sm:w-auto inline-flex items-center justify-center px-8 py-4 bg-white text-green-600 font-semibold rounded-xl hover:bg-green-50 transition-all duration-300 shadow-xl hover:shadow-2xl transform hover:-translate-y-1">
                                        <svg class="w-5 h-5 mr-3 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                        Get Started Today
                                    </a>
                                {% endif %}
                                <a href="{{ url_for('about') }}" class="w-full sm:w-auto inline-flex items-center justify-center px-8 py-4 bg-green-500 bg-opacity-20 text-white font-semibold rounded-xl hover:bg-opacity-30 transition-all duration-300 border-2 border-green-300 backdrop-blur-sm">
                                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Learn More
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Slide 2 & 3 content remains the same... -->
                <!-- (keeping your existing slides 2 and 3 code) -->
            </div>
            
            <!-- Carousel Navigation -->
            <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 flex space-x-3 z-20">
                <button class="w-3 h-3 bg-white rounded-full opacity-100 transition-all duration-300" onclick="showSlide(1)"></button>
                <button class="w-3 h-3 bg-white rounded-full opacity-50 transition-all duration-300" onclick="showSlide(2)"></button>
                <button class="w-3 h-3 bg-white rounded-full opacity-50 transition-all duration-300" onclick="showSlide(3)"></button>
            </div>
        </section>
        
        <!-- (Rest of your home page content remains the same...) -->
        
        {% elif page == 'chatbot' %}
        <!-- Chatbot Page -->
        <section class="min-h-screen flex items-center justify-center p-4 py-24" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
            <div class="chat-container w-full max-w-5xl bg-white rounded-3xl shadow-2xl flex flex-col overflow-hidden" style="height: 700px;">
                <!-- Chat Header -->
                <div class="chat-header bg-gradient-to-r from-green-600 to-emerald-700 text-white p-6 flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center mr-4">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold flex items-center gap-3">
                                <span class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></span>
                                E-Waste Assistant Bot
                            </h2>
                            <p class="text-green-100 text-sm">Ask me anything about e-waste recycling</p>
                        </div>
                    </div>
                    <button onclick="clearChat()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-6 py-2 rounded-xl transition-all duration-300 font-medium">
                        Clear Chat
                    </button>
                </div>

                <!-- Chat Messages -->
                <div id="chatMessages" class="flex-1 overflow-y-auto p-6 bg-gradient-to-br from-gray-50 to-green-50 space-y-4">
                    <div class="welcome-message text-center py-16">
                        <div class="w-24 h-24 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                            <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"></path>
                            </svg>
                        </div>
                        <h3 class="text-3xl font-bold text-green-600 mb-4">üëã Welcome to E-Waste Assistant!</h3>
                        <p class="text-gray-600 text-lg max-w-2xl mx-auto">Ask me anything about electronic waste disposal, recycling, device management, or environmental impact. I'm here to help you make eco-friendly choices!</p>
                        <div class="mt-8 flex flex-wrap gap-3 justify-center">
                            <button onclick="sendSuggestion('How do I recycle my old phone?')" class="bg-green-100 text-green-700 px-4 py-2 rounded-full hover:bg-green-200 transition-colors text-sm font-medium">
                                üì± Recycle old phone
                            </button>
                            <button onclick="sendSuggestion('What happens to e-waste?')" class="bg-blue-100 text-blue-700 px-4 py-2 rounded-full hover:bg-blue-200 transition-colors text-sm font-medium">
                                üåç E-waste impact
                            </button>
                            <button onclick="sendSuggestion('Where can I donate electronics?')" class="bg-purple-100 text-purple-700 px-4 py-2 rounded-full hover:bg-purple-200 transition-colors text-sm font-medium">
                                üíù Donate electronics
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quick Suggestions -->
                <div id="suggestions" class="px-6 py-3 flex flex-wrap gap-2 border-t border-gray-200 bg-white"></div>

                <!-- Chat Input -->
                <div class="p-6 bg-white border-t-2 border-gray-200">
                    <div class="flex gap-3 items-center">
                        <input 
                            type="text" 
                            id="chatInput" 
                            class="flex-1 px-5 py-4 border-2 border-gray-300 rounded-2xl focus:border-green-500 focus:outline-none transition-colors text-base"
                            placeholder="Type your message about e-waste..."
                            onkeypress="handleKeyPress(event)"
                        >
                        <button 
                            id="sendBtn"
                            onclick="sendMessage()" 
                            class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white px-8 py-4 rounded-2xl font-semibold transition-all duration-300 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <style>
            .message {
                display: flex;
                margin-bottom: 1.25rem;
                animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(15px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .message.user {
                justify-content: flex-end;
            }

            .message-content {
                max-width: 75%;
                padding: 1rem 1.25rem;
                border-radius: 1.5rem;
                word-wrap: break-word;
                line-height: 1.6;
                font-size: 0.95rem;
            }

            .message.user .message-content {
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                color: white;
                border-bottom-right-radius: 0.5rem;
                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            }

            .message.bot .message-content {
                background: white;
                color: #1e293b;
                border-bottom-left-radius: 0.5rem;
                box-shadow: 0 2px 12px rgba(0,0,0,0.08);
                border: 1px solid #e5e7eb;
            }

            .suggestion-chip {
                background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
                color: #16a34a;
                padding: 0.625rem 1.25rem;
                border-radius: 9999px;
                font-size: 0.875rem;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                border: 1px solid #86efac;
            }

            .suggestion-chip:hover {
                background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
                color: white;
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(22, 163, 74, 0.3);
            }

            .typing-indicator {
                display: none;
                padding: 1rem 1.25rem;
                background: white;
                border-radius: 1.5rem;
                width: fit-content;
                box-shadow: 0 2px 12px rgba(0,0,0,0.08);
                border: 1px solid #e5e7eb;
            }

            .typing-indicator.active {
                display: block;
            }

            .typing-indicator span {
                display: inline-block;
                width: 10px;
                height: 10px;
                background: #10b981;
                border-radius: 50%;
                margin: 0 3px;
                animation: bounce 1.4s infinite ease-in-out;
            }

            .typing-indicator span:nth-child(2) {
                animation-delay: 0.2s;
            }

            .typing-indicator span:nth-child(3) {
                animation-delay: 0.4s;
            }

            @keyframes bounce {
                0%, 60%, 100% { transform: translateY(0); }
                30% { transform: translateY(-10px); }
            }

            #chatMessages::-webkit-scrollbar {
                width: 8px;
            }

            #chatMessages::-webkit-scrollbar-track {
                background: #f1f5f9;
                border-radius: 10px;
            }

            #chatMessages::-webkit-scrollbar-thumb {
                background: #10b981;
                border-radius: 10px;
            }

            #chatMessages::-webkit-scrollbar-thumb:hover {
                background: #059669;
            }
        </style>

        <script>
            let conversationHistory = [];

            function addMessage(content, isUser = false) {
                const messagesContainer = document.getElementById('chatMessages');
                const welcomeMsg = messagesContainer.querySelector('.welcome-message');
                if (welcomeMsg) {
                    welcomeMsg.remove();
                }

                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                contentDiv.textContent = content;
                
                messageDiv.appendChild(contentDiv);
                messagesContainer.appendChild(messageDiv);
                
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                conversationHistory.push({
                    role: isUser ? 'user' : 'assistant',
                    content: content
                });
            }

            function showTypingIndicator() {
                const messagesContainer = document.getElementById('chatMessages');
                const indicator = document.createElement('div');
                indicator.className = 'message bot';
                indicator.innerHTML = `
                    <div class="typing-indicator active">
                        <span></span><span></span><span></span>
                    </div>
                `;
                indicator.id = 'typingIndicator';
                messagesContainer.appendChild(indicator);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            function hideTypingIndicator() {
                const indicator = document.getElementById('typingIndicator');
                if (indicator) {
                    indicator.remove();
                }
            }

            function updateSuggestions(suggestions) {
                const suggestionsContainer = document.getElementById('suggestions');
                suggestionsContainer.innerHTML = '';
                
                if (suggestions && suggestions.length > 0) {
                    suggestions.forEach(suggestion => {
                        const chip = document.createElement('button');
                        chip.className = 'suggestion-chip';
                        chip.textContent = suggestion;
                        chip.onclick = () => sendSuggestion(suggestion);
                        suggestionsContainer.appendChild(chip);
                    });
                }
            }

            function sendSuggestion(text) {
                document.getElementById('chatInput').value = text;
                sendMessage();
            }

            async function sendMessage() {
                const input = document.getElementById('chatInput');
                const sendBtn = document.getElementById('sendBtn');
                const message = input.value.trim();

                if (!message) return;

                input.disabled = true;
                sendBtn.disabled = true;

                addMessage(message, true);
                input.value = '';

                showTypingIndicator();

                try {
                    const response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: message,
                            history: conversationHistory
                        })
                    });

                    const data = await response.json();

                    hideTypingIndicator();

                    if (response.ok) {
                        addMessage(data.response, false);
                        updateSuggestions(data.suggestions || []);
                    } else {
                        addMessage('Sorry, I encountered an error. Please try again.', false);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    hideTypingIndicator();
                    addMessage('Sorry, I could not connect to the server. Please try again later.', false);
                } finally {
                    input.disabled = false;
                    sendBtn.disabled = false;
                    input.focus();
                }
            }

            function handleKeyPress(event) {
                if (event.key === 'Enter') {
                    sendMessage();
                }
            }

            async function clearChat() {
                if (!confirm('Are you sure you want to clear the chat history?')) {
                    return;
                }

                conversationHistory = [];
                const messagesContainer = document.getElementById('chatMessages');
                messagesContainer.innerHTML = `
                    <div class="welcome-message text-center py-16">
                        <div class="w-